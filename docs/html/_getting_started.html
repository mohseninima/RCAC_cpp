<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>RCAC C++: Getting Started</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">RCAC C++
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_getting_started.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Getting Started </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This is a guide on getting started with the <a class="el" href="class_r_c_a_c.html">RCAC</a> library.</p>
<h1>How to install? </h1>
<p>First download the source code from the <a href="https://github.com/mohseninima/RCAC_cpp">repository</a>. Only the *.cpp and *.hpp files are needed. Next, you will need a copy of the Eigen matrix library, located <a href="http://eigen.tuxfamily.org/">here</a>. Extract the <em>Eigen</em> and <em>unsupported</em> folders and place them in the same folder as the <a class="el" href="class_r_c_a_c.html">RCAC</a> code. You should have a folder structure similar to the following.</p>
<div class="fragment"><div class="line">&lt;root&gt;</div><div class="line">    Eigen/</div><div class="line">    unsupported/</div><div class="line">    RCAC.cpp</div><div class="line">    RCAC.hpp</div><div class="line">    RCACCreator.hpp</div><div class="line">    RCAC*.cpp</div><div class="line">    RCAC*.hpp</div><div class="line">    .</div><div class="line">    .</div><div class="line">    .</div><div class="line">    main.cpp (your code)</div></div><!-- fragment --><h1>Using Recursive Least Squares (RLS) <a class="el" href="class_r_c_a_c.html">RCAC</a> in C++ </h1>
<p>Using RLS <a class="el" href="class_r_c_a_c.html">RCAC</a> in your own code requires 6 main steps</p>
<ol type="1">
<li>Including "RCACCreator.hpp" and Eigen</li>
<li>Defining and assigning the <a class="el" href="structrcac_rls_flags.html">rcacRlsFlags</a> struct</li>
<li>Defining and assigning the <a class="el" href="structrcac_filt.html">rcacFilt</a> struct</li>
<li>Initializing <a class="el" href="class_r_c_a_c.html">RCAC</a> using <a class="el" href="class_r_c_a_c.html#af7b7133b676886d5010be725291c1a1d">RCAC::init()</a></li>
<li>Using the <a class="el" href="class_r_c_a_c.html#a956bb6a557f050d3808d5392fd3add20">RCAC::oneStep()</a> method to propagate <a class="el" href="class_r_c_a_c.html">RCAC</a> by one step</li>
<li>Using the <a class="el" href="class_r_c_a_c.html#ad93e5753d1810d7c3b2f6fbf56857a51">RCAC::getControl()</a> method to get the associated control input</li>
</ol>
<h2>Creating the <a class="el" href="structrcac_rls_flags.html">rcacRlsFlags</a> struct </h2>
<p>This struct defines the base parameters such as controller order and sizes of the inputs and outputs. The list of members is</p><ul>
<li>lu: Number of control inputs (Type: int)</li>
<li>ly: Number of sensor measurements (Type: int)</li>
<li>lz: Number of performance measurements (Type: int)</li>
<li>Nc: Controller order (Type: int)</li>
<li>filtorder: Order of the filter <img class="formulaInl" alt="$G_f$" src="form_0.png"/> (Type: int)</li>
<li>k_0: Starting timestep for the controller (Type: int) (Usually = Nc)</li>
<li>P0: Initial value of the covariance matrix for RLS (Type: Eigen::MatrixXd) (ltheta by ltheta)</li>
<li>Ru: Weighting matrix on the control input (Type: Eigen::MatrixXd) (lu by lu)</li>
<li>Rz: Weighting matrix on the retrospective performance (usually identity) (Type: Eigen::MatrixXd) (lz by lz)</li>
<li>lambda: The forgetting factor for RLS (Type: double)</li>
<li>theta_0: Initial value for the controller coefficients (Type: Eigen::VectorXd) (ltheta by 1)</li>
</ul>
<p>The parameter ltheta is not needed to be given to <a class="el" href="class_r_c_a_c.html">RCAC</a> directly but is useful for initialization. It is defined as <img class="formulaInl" alt="$ l_\theta = N_c l_u(l_u+l_y) $" src="form_2.png"/></p>
<p>An example struct for a 2 input 2 output plant with a 10th order controller and filtorder of 4 is given below </p><div class="fragment"><div class="line"><a class="code" href="structrcac_rls_flags.html">rcacRlsFlags</a> FLAGS;</div><div class="line">FLAGS.lu = 2;</div><div class="line">FLAGS.lz = 2;</div><div class="line">FLAGS.ly = 2;</div><div class="line">FLAGS.Nc = 4;</div><div class="line"><span class="keywordtype">int</span> ltheta = FLAGS.Nc*FLAGS.lu*(FLAGS.lu+FLAGS.ly); <span class="comment">//Define ltheta to help create other variables</span></div><div class="line">FLAGS.filtorder = 4;</div><div class="line">FLAGS.k_0 = FLAGS.Nc;</div><div class="line">FLAGS.P0 = 100000*Eigen::MatrixXd::Identity(ltheta, ltheta); <span class="comment">//Create a matrix with diag values of 100000</span></div><div class="line">FLAGS.Ru = Eigen::MatrixXd::Zero(FLAGS.lu, FLAGS.lu); <span class="comment">//Create a zero matrix (no weighting on control effort)</span></div><div class="line">FLAGS.Rz = Eigen::MatrixXd::Identity(FLAGS.lz, FLAGS.lz); <span class="comment">//Create the identity matrix</span></div><div class="line">FLAGS.lambda = 1;</div><div class="line">FLAGS.theta_0 = Eigen::MatrixXd::Zero(ltheta, 1); <span class="comment">//Initialize the RCAC coefficients to zero</span></div></div><!-- fragment --><h2>Creating the <a class="el" href="structrcac_filt.html">rcacFilt</a> struct </h2>
<p>This struct defines the coefficients of the <a class="el" href="class_r_c_a_c.html">RCAC</a> filter <img class="formulaInl" alt="$G_f$" src="form_0.png"/> and a filter for the performance measurements The list of members is</p><ul>
<li>filtNu: Numerator coefficients of <img class="formulaInl" alt="$G_f$" src="form_0.png"/> (Type: Eigen::MatrixXd) (lz by lu*filtorder)</li>
<li>filtDu: Denominator coefficients of <img class="formulaInl" alt="$G_f$" src="form_0.png"/> (Type: Eigen::MatrixXd) (lz by lu*(filtorder-1))</li>
<li>filtNz: Numerator coefficients of a filter on the performance measurement. Usually identity. (Type: Eigen::MatrixXd) (lz by lz)</li>
<li>filtDz: Denominator coefficients of a filter on the performance measurement. Usually a zero matrix. (Type: Eigen::MatrixXd) (lz by lz)</li>
</ul>
<p>An example struct for a 2 input 2 output plant with a filterorder of 4 is given below. In this example, the comma initializer syntax from Eigen is used to construct filtNu and filtDu </p><div class="fragment"><div class="line"><a class="code" href="structrcac_filt.html">rcacFilt</a> FILT;</div><div class="line">FILT.filtNu.resize(FLAGS.lz, FLAGS.lu*filtorder); <span class="comment">//Set the size of the matrix to use the comma initializer syntax</span></div><div class="line">FILT.filtNu &lt;&lt; 0, 0, 1, 0, 0.25, 1, 0.0625, 0.5, <span class="comment">//Use the comma initializer syntax</span></div><div class="line">               0, 0, 0, 3, 0, 0.75, 0, 0.1875;</div><div class="line"></div><div class="line">FILT.filtDu.resize(FLAGS.lz, FLAGS.lz*(filtorder-1));</div><div class="line">FILT.filtDu &lt;&lt; 0, 0, 0, 0, 0, 0,</div><div class="line">               0, 0, 0, 0, 0, 0;</div><div class="line"></div><div class="line">FILT.filtNz = MatrixXd::Identity(FLAGS.lz, FLAGS.lz);</div><div class="line">FILT.filtDz =  MatrixXd::Zero(FLAGS.lz, FLAGS.lz);</div></div><!-- fragment --><h2>Initializing <a class="el" href="class_r_c_a_c.html">RCAC</a> </h2>
<p>Once the required <a class="el" href="structrcac_rls_flags.html">rcacRlsFlags</a> and <a class="el" href="structrcac_filt.html">rcacFilt</a> structs are created. <a class="el" href="class_r_c_a_c.html">RCAC</a> can be initialized. Initialization requires a flag struct, filt struct, and a string specifying the type of <a class="el" href="class_r_c_a_c.html">RCAC</a> to be used.</p>
<div class="fragment"><div class="line"><span class="comment">//String stating the type of RCAC to use</span></div><div class="line">std::string rcacType = <span class="stringliteral">&quot;RLS&quot;</span>;</div><div class="line"></div><div class="line"><span class="comment">//Create a pointer to an RCAC object</span></div><div class="line"><a class="code" href="class_r_c_a_c.html">RCAC</a> *myRCAC;</div><div class="line"></div><div class="line"><span class="comment">//initialize RCAC with flags defined by an rcacRlsFlags struct</span></div><div class="line">myRCAC = myRCAC-&gt;<a class="code" href="class_r_c_a_c.html#af7b7133b676886d5010be725291c1a1d">init</a>&lt;<a class="code" href="structrcac_rls_flags.html">rcacRlsFlags</a>&gt;(FLAGS, FILT, rcacType);</div></div><!-- fragment --><h2>Compiling </h2>
<p>A program that uses <a class="el" href="class_r_c_a_c.html">RCAC</a> can be compiled using the following command </p><div class="fragment"><div class="line">g++ -O3 main.cpp RCAC.cpp RCACRLS.cpp RCACGrad.cpp -o main</div></div><!-- fragment --><h2>Putting it all together </h2>
<p>Below is an example of using <a class="el" href="class_r_c_a_c.html">RCAC</a> to control a 2x2 2nd order MIMO system to follow a step command with a 4th order controller using 3 markov parameters</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;Eigen/Core&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="_r_c_a_c_creator_8hpp.html">RCACCreator.hpp</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespace_eigen.html">Eigen</a>;</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main()</div><div class="line">{</div><div class="line">    <span class="comment">//**************Simulation Parameters***************</span></div><div class="line">    <span class="comment">//Initialize the plant</span></div><div class="line">    <span class="keywordtype">int</span> lx = 2;</div><div class="line">    <span class="keywordtype">int</span> lu = 2;</div><div class="line">    <span class="keywordtype">int</span> ly = 2;</div><div class="line">    <span class="keywordtype">int</span> lz = ly;</div><div class="line"></div><div class="line">    MatrixXd A(lx,lx);</div><div class="line">    A &lt;&lt; 0.25,1,</div><div class="line">          0,0.25;</div><div class="line"></div><div class="line">    MatrixXd B(lx,lu);</div><div class="line">    B &lt;&lt; 1,0,</div><div class="line">         0,1;</div><div class="line"></div><div class="line">    MatrixXd C(ly,lx);</div><div class="line">    C &lt;&lt; 1,0,</div><div class="line">         0,3;</div><div class="line"></div><div class="line">    MatrixXd x(lx,1);</div><div class="line">    x &lt;&lt; 0,</div><div class="line">         0;</div><div class="line"></div><div class="line">    <span class="comment">//End time of the simulation</span></div><div class="line">    <span class="keywordtype">int</span> kend = 30;</div><div class="line">    <span class="comment">//*************************************************</span></div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">//***************RCAC Parameters*******************</span></div><div class="line">    <span class="comment">//Set Flags</span></div><div class="line">    <a class="code" href="structrcac_rls_flags.html">rcacRlsFlags</a> FLAGS;</div><div class="line">    FLAGS.lu = lu;</div><div class="line">    FLAGS.lz = lz;</div><div class="line">    FLAGS.ly = ly;</div><div class="line">    FLAGS.Nc = 4;</div><div class="line">    <span class="keywordtype">int</span> ltheta = FLAGS.Nc*FLAGS.lu*(FLAGS.lu+FLAGS.ly);</div><div class="line">    FLAGS.filtorder = 4;</div><div class="line">    FLAGS.k_0 = FLAGS.Nc;</div><div class="line">    FLAGS.P0 = 100000*MatrixXd::Identity(ltheta, ltheta);</div><div class="line">    FLAGS.Ru = MatrixXd::Zero(FLAGS.lu, FLAGS.lu);</div><div class="line">    FLAGS.Rz = MatrixXd::Identity(FLAGS.lz, FLAGS.lz);</div><div class="line">    FLAGS.lambda = 1;</div><div class="line">    FLAGS.theta_0 = MatrixXd::Zero(ltheta, 1);</div><div class="line"></div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Flags Set\n&quot;</span>; </div><div class="line"></div><div class="line">    <span class="comment">//Set Filter</span></div><div class="line">    <a class="code" href="structrcac_filt.html">rcacFilt</a> FILT;</div><div class="line">    <span class="keywordtype">int</span> Hnum = FLAGS.filtorder-1;</div><div class="line">    FILT.filtNu.resize(FLAGS.lz, FLAGS.lu*(Hnum+1));</div><div class="line">    FILT.filtDu.resize(FLAGS.lz, FLAGS.lz*Hnum);</div><div class="line">    FILT.filtNu &lt;&lt; 0, 0, 1, 0, 0.25, 1, 0.0625, 0.5,</div><div class="line">                   0, 0, 0, 3, 0, 0.75, 0, 0.1875; </div><div class="line">    FILT.filtDu &lt;&lt; 0, 0, 0, 0, 0, 0,</div><div class="line">                   0, 0, 0, 0, 0, 0;</div><div class="line">    FILT.filtNz = MatrixXd::Identity(FLAGS.lz, FLAGS.lz);</div><div class="line">    FILT.filtDz =  MatrixXd::Zero(FLAGS.lz, FLAGS.lz);</div><div class="line"></div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Filter Set\n&quot;</span>; </div><div class="line"></div><div class="line">    <span class="comment">//Initialize RCAC</span></div><div class="line">    std::string rcacType = <span class="stringliteral">&quot;RLS&quot;</span>;</div><div class="line">    <a class="code" href="class_r_c_a_c.html">RCAC</a> *myRCAC;</div><div class="line">    <span class="comment">//Call the factory method to initialize RCAC</span></div><div class="line">    myRCAC = myRCAC-&gt;<a class="code" href="class_r_c_a_c.html#af7b7133b676886d5010be725291c1a1d">init</a>&lt;<a class="code" href="structrcac_rls_flags.html">rcacRlsFlags</a>&gt;(FLAGS, FILT, rcacType);</div><div class="line"></div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;RLS Init\n&quot;</span>; </div><div class="line">    <span class="comment">//**************************************************</span></div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">//******************Simulation**********************</span></div><div class="line">    <span class="comment">//Run Simulation</span></div><div class="line">    VectorXd y(FLAGS.ly,1);</div><div class="line">    VectorXd z(FLAGS.lz,1);</div><div class="line">    VectorXd u(FLAGS.lu,1);</div><div class="line">    u = MatrixXd::Zero(FLAGS.lu, 1);</div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; kend; k++)</div><div class="line">    {</div><div class="line">        y = C*x;</div><div class="line">        z = y - VectorXd::Ones(FLAGS.ly);</div><div class="line"></div><div class="line">        x = A*x + B*u;        </div><div class="line"></div><div class="line">        myRCAC-&gt;<a class="code" href="class_r_c_a_c.html#a956bb6a557f050d3808d5392fd3add20">oneStep</a>(u, z, z); <span class="comment">//Compute one step of RCAC</span></div><div class="line">        u = myRCAC-&gt;<a class="code" href="class_r_c_a_c.html#ad93e5753d1810d7c3b2f6fbf56857a51">getControl</a>(); <span class="comment">//Get the resulting control</span></div><div class="line"></div><div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;y: &quot;</span> &lt;&lt; y &lt;&lt; <span class="stringliteral">&quot;, z: &quot;</span> &lt;&lt; z &lt;&lt; <span class="stringliteral">&quot;, u: &quot;</span> &lt;&lt; u &lt;&lt; std::endl;</div><div class="line">    }</div><div class="line">    <span class="comment">//****************************************************</span></div><div class="line"></div><div class="line">    <span class="keywordflow">return</span>(0);</div><div class="line">}</div></div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
